import requests
import json
import sys

API_HOST = 'https://access.redhat.com/hydra/rest/securitydata'
endpoint = '/cve.json'
params = 'after=2022-09-01' + 'before=2022-09-06' # + 'product=openstack' + 'sevrity=important' + 'ids=CVE-2022-2735' 


def get_data(query):
    full_query = API_HOST + query
    r = requests.get(full_query)

    if r.status_code != 200:
        print('ERROR: Invalid request; returned' + str(r.status_code) + 'for the following query: \n' + full_query)

    if not r.json():
        print('\nNo data returned with the following query: \n' + full_query)
        #print(full_query)
        print('\n')
        sys.exit(0)

    return r.json()

def pretty_print_cve(data):
    print('\n')
    print('CVE Number: \t| Severity: | Public date: | URL: \n')
    
    cves_printed = []

    for cve in data:
        #print('{} \t |   {} \t |   Public date:{}'.format(cve['CVE'], cve['severity'], cve['public_date']))
        if cve['CVE'] not in cves_printed:
            cves_printed.append(cve['CVE'])
            print('{:<15} | {:<9} | {:<12} | {:<50}'.format(cve['CVE'], cve['severity'], cve['public_date'][0:10], cve['resource_url']))
    
    print(cves_printed)

    print('\n')


data = get_data(endpoint + '?' + params)
#data_json = json.dumps(data, indent=4)
#print(data_json)

pretty_print_cve(data)


""" for cve in data:
    params2 = 'ids=' + cve['CVE']
    data2 = get_data(endpoint + '?' + params2)
    data2_json = json.dumps(data2, indent=4)

    print(data2_json)  """
